/*
 * to-markdown - an HTML to Markdown converter
 *
 * Copyright 2011, Dom Christie
 * Licenced under the MIT licence
 *
 */var toMarkdown=function(e){function o(e,t){var n=t.type==="void"?"<"+t.tag+"\\b([^>]*)\\/?>":"<"+t.tag+"\\b([^>]*)>([\\s\\S]*?)<\\/"+t.tag+">",r=new RegExp(n,"gi"),i="";return typeof t.replacement=="string"?i=e.replace(r,t.replacement):i=e.replace(r,function(e,n,r,i){return t.replacement.call(this,e,n,r,i)}),i}function u(e){return new RegExp(e+"\\s*=\\s*[\"']?([^\"']*)[\"']?","i")}function f(e){return e=e.replace(/<(ul|ol)\b[^>]*>([\s\S]*?)<\/\1>/gi,function(e,t,i){var s=i.split("</li>");s.splice(s.length-1,1);for(n=0,r=s.length;n<r;n++)if(s[n]){var o=t==="ol"?n+1+".  ":"*   ";s[n]=s[n].replace(/\s*<li[^>]*>([\s\S]*)/i,function(e,t){return t=t.replace(/^\s+/,""),t=t.replace(/\n\n/g,"\n\n    "),t=t.replace(/\n([ ]*)+(\*|\d+\.) /g,"\n$1    $2 "),o+t})}return s.join("\n")}),"\n\n"+e.replace(/[ \t]+\n|\s+$/g,"")}function c(e){return e=e.replace(/<blockquote\b[^>]*>([\s\S]*?)<\/blockquote>/gi,function(e,t){return t=t.replace(/^\s+|\s+$/g,""),t=h(t),t=t.replace(/^/gm,"> "),t=t.replace(/^(>([ \t]{2,}>)+)/gm,"> >"),t}),e}function h(e){return e=e.replace(/^[\t\r\n]+|[\t\r\n]+$/g,""),e=e.replace(/\n\s+\n/g,"\n\n"),e=e.replace(/\n{3,}/g,"\n\n"),e}var t=[{patterns:"p",replacement:function(e,t,n){return n?"\n\n"+n+"\n":""}},{patterns:"br",type:"void",replacement:"\n"},{patterns:"h([1-6])",replacement:function(e,t,n,r){var i="";for(var s=0;s<t;s++)i+="#";return"\n\n"+i+" "+r+"\n"}},{patterns:"hr",type:"void",replacement:"\n\n* * *\n"},{patterns:"a",replacement:function(e,t,n){var r=t.match(u("href")),i=t.match(u("title"));return r?"["+n+"]"+"("+r[1]+(i&&i[1]?' "'+i[1]+'"':"")+")":e}},{patterns:["b","strong"],replacement:function(e,t,n){return n?"**"+n+"**":""}},{patterns:["i","em"],replacement:function(e,t,n){return n?"_"+n+"_":""}},{patterns:"code",replacement:function(e,t,n){return n?"`"+n+"`":""}},{patterns:"img",type:"void",replacement:function(e,t,n){var r=t.match(u("src")),i=t.match(u("alt")),s=t.match(u("title"));return"!["+(i&&i[1]?i[1]:"")+"]"+"("+r[1]+(s&&s[1]?' "'+s[1]+'"':"")+")"}}];for(var n=0,r=t.length;n<r;n++)if(typeof t[n].patterns=="string")e=o(e,{tag:t[n].patterns,replacement:t[n].replacement,type:t[n].type});else for(var i=0,s=t[n].patterns.length;i<s;i++)e=o(e,{tag:t[n].patterns[i],replacement:t[n].replacement,type:t[n].type});e=e.replace(/<pre\b[^>]*>`([\s\S]*)`<\/pre>/gi,function(e,t){return t=t.replace(/^\t+/g,"  "),t=t.replace(/\n/g,"\n    "),"\n\n    "+t+"\n"}),e=e.replace(/^(\s{0,3}\d+)\. /g,"$1\\. ");var a=/<(ul|ol)\b[^>]*>(?:(?!<ul|<ol)[\s\S])*?<\/\1>/gi;while(e.match(a))e=e.replace(a,function(e){return f(e)});var l=/<blockquote\b[^>]*>((?:(?!<blockquote)[\s\S])*?)<\/blockquote>/gi;while(e.match(l))e=e.replace(l,function(e){return c(e)});return h(e)};typeof exports=="object"&&(exports.toMarkdown=toMarkdown);